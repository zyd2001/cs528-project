# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "requests",
# ]
# ///
import requests
import sys
import hashlib
from pathlib import Path

if len(sys.argv) < 2:
    print(f"Usage: python {sys.argv[0]} <path>")
    sys.exit(1)

path = sys.argv[1]  

url = "http://127.0.0.1:7860/queue/join?"
headers = {"content-type": "application/json"}

data = {
    "data": [
        [
            {
                "path": path,  
                "url": "http://127.0.0.1:7860/file=/tmp/gradio/d29f53f2aa166f690d19ef61eeb6624869eee0c0e0e7c99193ee91d8fa39d47c/256x256.png", # doesn't matter
                "orig_name": "256x256.png",
                "size": 65094,
                "mime_type": "image/png",
                "meta": {"_type": "gradio.FileData"}
            }
        ]
    ],
    "event_data": None,
    "fn_index": 0,
    "trigger_id": 2,
    "session_hash": "0" # also doesn't matter
}

response = requests.post(url, headers=headers, json=data)
sha256 = hashlib.sha256()
sha256.update(path.encode("utf-8"))
print(f"file in http://127.0.0.1:7860/file=/tmp/gradio/{sha256.hexdigest()}/{Path(path).name}")
